<div class="container mt-3" style="width: 100%">

    <!--####SEARCH####-->
    <div *ngIf="users?.length>0 && !editarUsuario" class="text-end col-md-12">
        <span class="p-input-icon-right">
            <i class="pi pi-search"></i>
            <input pInputText #textInput
                    type="text" 
                    (input)="dt2.filterGlobal(textInput.value, 'contains')" 
                    placeholder="Search keyword" 
                    style="width: 500px;"/>
        </span>
    </div>

    
        <!--####INICIO_TABLE####-->
        <div *ngIf="users?.length>0 && !editarUsuario" class="card mb-3 mt-3">
        <div class="card-body">
            <div class="row">
                <div class="col-8">
                    <h4 class="card-title">Total de usuarios: ({{totalRegistros}})</h4>
                    <h6 class="card-subtitle">Listado de usuarios</h6>
                </div>

                <div class="col">
                    <div class="text-end">
                        <a class="btn btn-success" [routerLink]="['./create']">
                            <i class="fa fa-plus"></i>
                            &nbsp;&nbsp;Crear usuario
                        </a>
                    </div>
                </div>
            </div>
            <!--####TABLE####-->
           
                <p-table [value]="users" 
                         [totalRecords]="totalRegistros" 
                         [rows]="10" 
                         [pageLinks]="3"
                         [rowsPerPageOptions]="[10, 25, 50]" 
                         [paginator]="true" 
                         [showCurrentPageReport]="true"
                         currentPageReportTemplate="Página {currentPage} de {totalPages} páginas"
                         [showCurrentPageReport]="true" 
                         [resizableColumns]="false"
                         [tableStyle]="{ overflow: 'hidden','min-width': '60rem' }" 
                         [(first)]="first" 
                         [lazy]="true"
                         (onLazyLoad)="lazyLoadTable($event)" 
                         [scrollable]="true" 
                         scrollHeight="440px" 
                         #dt2 dataKey="id"
                         [alwaysShowPaginator]="false"
                         styleClass="p-datatable-gridlines">

                    <!--####HEADER_TABLE####-->
                    <ng-template pTemplate="header">
                        <tr>
                            <th scope="col" style="width:2%">AVATAR</th>
                            <th scope="col" pSortableColumn="nombre" style="width:10%">NOMBRES <p-sortIcon
                                    field="nombre"></p-sortIcon></th>
                            <th scope="col" pSortableColumn="apellido" style="width:10%">APELLIDOS <p-sortIcon
                                    field="apellido"></p-sortIcon></th>
                            <th scope="col" pSortableColumn="username" style="width:10%">NOMBRE DE USUARIO <p-sortIcon
                                    field="username"></p-sortIcon></th>
                            <th scope="col" style="width:3%">ESTADO</th>
                            <th scope="col" style="width:10%">ACCIONES</th>
                        </tr>
                    </ng-template>
                    <!--####EMPTY_MENSAJE####-->
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="9">
                                <section id="no-data" class="no-data">
                                    <app-data-empty [iconEmpty]="ICON_EMPTY" [titleEmpty]="TITLE_EMPTY"
                                        [contentEmpty]="CONTENT_EMPTY"></app-data-empty>
                                </section>
                            </td>
                        </tr>
                    </ng-template>
                    <!--####BODY_TABLE####-->
                    <ng-template pTemplate="body" let-user>
                        <tr>
                            <td class="text-center">
                                <p-avatar [image]="user.foto | imagen:'usuario'" 
                                          styleClass="mr-2" 
                                          size="xlarge"
                                          shape="circle"
                                          class="cursor"
                                          (click)="abrirModal(user.id, user.foto)"></p-avatar>
                            </td>
                            <td>{{ user.nombre }}</td>
                            <td>{{ user.apellido }}</td>
                            <td>{{ user.username }}</td>
                            <td class="text-nowrap">
                                <i class="fas fa-circle font-smallest font-icon"
                                    [ngClass]="obtenerIconoEstado(user.enabled)"></i>
                                {{ (user.enabled )? 'Activo':'Inactivo' }}
                            </td>
                            <td class="text-nowrap text-center">
                                <a (click)="modoEditar(user)"
                                       data-toggle="tooltip" 
                                       data-original-title="Editar"> 
                                       <i class="fa fa-pencil text-primary m-r-10 cursor me-3"></i> 
                                </a>

                                <a *ngIf="!user.enabled" (click)="activar(user)"
                                       class="cursor" 
                                       data-toggle="tooltip" 
                                       data-original-title="Borrar"> 
                                       <i class="fa-solid fa-power-off success"></i> 
                                </a>

                                <a *ngIf="user.enabled" (click)="desactivar(user)"
                                class="cursor" 
                                data-toggle="tooltip" 
                                data-original-title="Borrar"> 
                                <i class="fa-solid fa-power-off error"></i> 
                         </a>
                            </td>
                        </tr>
                    </ng-template>


                </p-table>
            
        </div>
    </div>

    <app-register-form *ngIf="editarUsuario"
                        [modoEditarAdmin]="true"
                        [usuario]="userEdit"
                        ></app-register-form>
</div>
